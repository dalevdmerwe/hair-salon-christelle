<div class="admin-container">
  <header class="admin-header">
    <h1>Tenant Management</h1>
    <button class="btn btn-primary" (click)="openCreateForm()">
      ➕ Add New Tenant
    </button>
  </header>

  <div *ngIf="loading" class="loading">
    <p>Loading tenants...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button class="btn btn-secondary" (click)="loadTenants()">Retry</button>
  </div>

  <div *ngIf="!loading && !error" class="tenants-table-container">
    <table class="tenants-table">
      <thead>
        <tr>
          <th>Logo</th>
          <th>Name</th>
          <th>Slug</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let tenant of tenants" [class.inactive]="!tenant.isActive">
          <td class="tenant-logo">
            <img *ngIf="tenant.imageUrl" [src]="tenant.imageUrl" [alt]="tenant.name" class="tenant-logo-img">
            <span *ngIf="!tenant.imageUrl" class="no-logo">📷</span>
          </td>
          <td class="tenant-name">{{ tenant.name }}</td>
          <td class="tenant-slug">{{ tenant.slug }}</td>
          <td>{{ tenant.email || '-' }}</td>
          <td>{{ tenant.phone || '-' }}</td>
          <td>
            <span class="status-badge" [class.active]="tenant.isActive" [class.inactive]="!tenant.isActive">
              {{ tenant.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td class="actions">
            <button class="btn-icon btn-bookings" (click)="goToBookings(tenant)" title="View Bookings">
              📅
            </button>
            <button class="btn-icon btn-services" (click)="goToServices(tenant)" title="Manage Services">
              📋
            </button>
            <button class="btn-icon btn-edit" (click)="openEditForm(tenant)" title="Edit">
              ✏️
            </button>
            <button class="btn-icon btn-toggle" (click)="toggleActive(tenant)"
                    [title]="tenant.isActive ? 'Deactivate' : 'Activate'">
              {{ tenant.isActive ? '👁️' : '🚫' }}
            </button>
            <button class="btn-icon btn-delete" (click)="deleteTenant(tenant)" title="Delete">
              🗑️
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="tenants.length === 0" class="no-tenants">
      <p>No tenants found. Click "Add New Tenant" to create one.</p>
    </div>
  </div>

  <!-- Modal Form -->
  <div class="modal" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingTenant ? 'Edit Tenant' : 'Add New Tenant' }}</h2>
        <button class="btn-close" (click)="closeForm()">✕</button>
      </div>

      <form (ngSubmit)="saveTenant()" class="tenant-form">
        <div class="form-group">
          <label for="name">Tenant Name *</label>
          <input 
            type="text" 
            id="name" 
            [(ngModel)]="tenantForm.name" 
            name="name"
            required
            placeholder="e.g., Christelle's Hair Salon"
            (blur)="generateSlug()"
          >
        </div>

        <div class="form-group">
          <label for="slug">URL Slug *</label>
          <input 
            type="text" 
            id="slug" 
            [(ngModel)]="tenantForm.slug" 
            name="slug"
            required
            placeholder="e.g., christelles-hair-salon"
            pattern="[a-z0-9\-]+"
          >
          <small class="help-text">URL-friendly identifier (lowercase, numbers, and hyphens only)</small>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea
            id="description"
            [(ngModel)]="tenantForm.description"
            name="description"
            rows="3"
            placeholder="Brief description of the tenant"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="image">Logo / Image</label>

          <!-- Image Preview -->
          <div class="image-upload-container">
            <div *ngIf="imagePreview" class="image-preview">
              <img [src]="imagePreview" alt="Preview">
              <button type="button" class="btn-remove-image" (click)="removeImage()" title="Remove image">
                ✕
              </button>
            </div>

            <!-- Upload Button -->
            <div class="upload-area" *ngIf="!imagePreview">
              <input
                type="file"
                id="image"
                accept="image/*"
                (change)="onFileSelected($event)"
                #fileInput
                style="display: none"
              >
              <button type="button" class="btn-upload" (click)="fileInput.click()">
                📷 Choose Image
              </button>
              <p class="upload-hint">PNG, JPG, GIF up to 5MB</p>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">Email</label>
            <input 
              type="email" 
              id="email" 
              [(ngModel)]="tenantForm.email" 
              name="email"
              placeholder="contact@example.com"
            >
          </div>

          <div class="form-group">
            <label for="phone">Phone</label>
            <input 
              type="tel" 
              id="phone" 
              [(ngModel)]="tenantForm.phone" 
              name="phone"
              placeholder="+27 XX XXX XXXX"
            >
          </div>
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <input
            type="text"
            id="address"
            [(ngModel)]="tenantForm.address"
            name="address"
            placeholder="Start typing address..."
            #addressInput
            (focus)="initAddressAutocomplete()"
          >
          <small class="help-text">Start typing to search for address</small>
        </div>

        <!-- Business Hours -->
        <div class="form-section">
          <h3>Business Hours</h3>
          <p class="section-help">Set operating hours for each day of the week</p>

          <div class="business-hours-grid">
            <div class="hours-row">
              <label for="monday">Monday</label>
              <input
                type="text"
                id="monday"
                [(ngModel)]="tenantForm.businessHours.monday"
                name="monday"
                placeholder="e.g., 9:00 AM - 5:00 PM or Closed"
              >
            </div>

            <div class="hours-row">
              <label for="tuesday">Tuesday</label>
              <input
                type="text"
                id="tuesday"
                [(ngModel)]="tenantForm.businessHours.tuesday"
                name="tuesday"
                placeholder="e.g., 9:00 AM - 5:00 PM or Closed"
              >
            </div>

            <div class="hours-row">
              <label for="wednesday">Wednesday</label>
              <input
                type="text"
                id="wednesday"
                [(ngModel)]="tenantForm.businessHours.wednesday"
                name="wednesday"
                placeholder="e.g., 9:00 AM - 5:00 PM or Closed"
              >
            </div>

            <div class="hours-row">
              <label for="thursday">Thursday</label>
              <input
                type="text"
                id="thursday"
                [(ngModel)]="tenantForm.businessHours.thursday"
                name="thursday"
                placeholder="e.g., 9:00 AM - 5:00 PM or Closed"
              >
            </div>

            <div class="hours-row">
              <label for="friday">Friday</label>
              <input
                type="text"
                id="friday"
                [(ngModel)]="tenantForm.businessHours.friday"
                name="friday"
                placeholder="e.g., 9:00 AM - 5:00 PM or Closed"
              >
            </div>

            <div class="hours-row">
              <label for="saturday">Saturday</label>
              <input
                type="text"
                id="saturday"
                [(ngModel)]="tenantForm.businessHours.saturday"
                name="saturday"
                placeholder="e.g., 10:00 AM - 2:00 PM or Closed"
              >
            </div>

            <div class="hours-row">
              <label for="sunday">Sunday</label>
              <input
                type="text"
                id="sunday"
                [(ngModel)]="tenantForm.businessHours.sunday"
                name="sunday"
                placeholder="e.g., Closed"
              >
            </div>
          </div>
        </div>

        <div class="form-group checkbox-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="tenantForm.isActive"
              name="isActive"
            >
            <span>Active (tenant can be accessed)</span>
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForm()" [disabled]="uploading">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="uploading">
            <span *ngIf="!uploading">{{ editingTenant ? 'Update Tenant' : 'Create Tenant' }}</span>
            <span *ngIf="uploading">⏳ Uploading...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

