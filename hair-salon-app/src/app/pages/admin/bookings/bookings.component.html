<app-admin-toolbar
  [tenant]="tenant"
  [tenantId]="tenantId"
  currentPage="bookings"
></app-admin-toolbar>

<div class="bookings-container">
  <div class="header">
    <h1>ğŸ“… Bookings Management</h1>
    <p class="subtitle">View and manage all appointments</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total Bookings</div>
      </div>
    </div>

    <div class="stat-card pending">
      <div class="stat-icon">â³</div>
      <div class="stat-info">
        <div class="stat-value">{{ stats.pending }}</div>
        <div class="stat-label">Pending</div>
      </div>
    </div>

    <div class="stat-card confirmed">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <div class="stat-value">{{ stats.confirmed }}</div>
        <div class="stat-label">Confirmed</div>
      </div>
    </div>

    <div class="stat-card today">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-info">
        <div class="stat-value">{{ stats.today }}</div>
        <div class="stat-label">Today</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="filter-group">
      <label for="search">ğŸ” Search</label>
      <input 
        type="text" 
        id="search" 
        placeholder="Search by name, phone, email..."
        (input)="onSearchChange($event)"
      >
    </div>

    <div class="filter-group">
      <label for="status">Status</label>
      <select id="status" (change)="onStatusFilterChange($event)">
        <option value="all">All Statuses</option>
        <option value="pending">Pending</option>
        <option value="confirmed">Confirmed</option>
        <option value="completed">Completed</option>
        <option value="cancelled">Cancelled</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="date">Date</label>
      <input 
        type="date" 
        id="date" 
        (change)="onDateFilterChange($event)"
      >
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <p>Loading bookings...</p>
  </div>

  <!-- Today's Bookings -->
  <div *ngIf="!loading && todayBookings.length > 0" class="section">
    <h2>ğŸŒŸ Today's Appointments</h2>
    <div class="bookings-list">
      <div *ngFor="let booking of todayBookings" class="booking-card today-booking">
        <div class="booking-header">
          <div class="customer-info">
            <h3>{{ booking.customerName }}</h3>
            <span class="badge" [ngClass]="getStatusClass(booking.status)">
              {{ booking.status }}
            </span>
          </div>
          <div class="booking-time">
            <span class="time">â° {{ booking.bookingTime }}</span>
          </div>
        </div>

        <div class="booking-details">
          <div class="detail-row">
            <span class="icon">ğŸ’‡</span>
            <span>{{ booking.serviceName }}</span>
          </div>
          <div class="detail-row">
            <span class="icon">â±ï¸</span>
            <span>{{ booking.serviceDuration }} minutes</span>
          </div>
          <div class="detail-row">
            <span class="icon">ğŸ’°</span>
            <span>R{{ booking.servicePrice }}</span>
          </div>
          <div class="detail-row">
            <span class="icon">ğŸ“±</span>
            <span>{{ booking.customerPhone }}</span>
          </div>
          <div *ngIf="booking.customerEmail" class="detail-row">
            <span class="icon">ğŸ“§</span>
            <span>{{ booking.customerEmail }}</span>
          </div>
          <div *ngIf="booking.notes" class="detail-row notes">
            <span class="icon">ğŸ“</span>
            <span>{{ booking.notes }}</span>
          </div>
        </div>

        <div class="booking-actions">
          <button *ngIf="booking.status === 'pending'" class="btn-confirm" (click)="confirmBooking(booking)">
            âœ… Confirm
          </button>
          <button *ngIf="booking.status === 'confirmed'" class="btn-complete" (click)="completeBooking(booking)">
            âœ”ï¸ Complete
          </button>
          <button class="btn-whatsapp" (click)="whatsappCustomer(booking.customerPhone)">
            ğŸ’¬ WhatsApp
          </button>
          <button class="btn-call" (click)="callCustomer(booking.customerPhone)">
            ğŸ“ Call
          </button>
          <button *ngIf="booking.status !== 'cancelled'" class="btn-cancel" (click)="cancelBooking(booking)">
            âŒ Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming Bookings -->
  <div *ngIf="!loading && upcomingBookings.length > 0" class="section">
    <h2>ğŸ“† Upcoming Appointments</h2>
    <div class="bookings-list">
      <div *ngFor="let booking of upcomingBookings" class="booking-card">
        <div class="booking-header">
          <div class="customer-info">
            <h3>{{ booking.customerName }}</h3>
            <span class="badge" [ngClass]="getStatusClass(booking.status)">
              {{ booking.status }}
            </span>
          </div>
          <div class="booking-date">
            <span class="date">ğŸ“… {{ formatDate(booking.bookingDate) }}</span>
            <span class="time">â° {{ booking.bookingTime }}</span>
          </div>
        </div>

        <div class="booking-details">
          <div class="detail-row">
            <span class="icon">ğŸ’‡</span>
            <span>{{ booking.serviceName }}</span>
          </div>
          <div class="detail-row">
            <span class="icon">â±ï¸</span>
            <span>{{ booking.serviceDuration }} minutes</span>
          </div>
          <div class="detail-row">
            <span class="icon">ğŸ’°</span>
            <span>R{{ booking.servicePrice }}</span>
          </div>
          <div class="detail-row">
            <span class="icon">ğŸ“±</span>
            <span>{{ booking.customerPhone }}</span>
          </div>
          <div *ngIf="booking.customerEmail" class="detail-row">
            <span class="icon">ğŸ“§</span>
            <span>{{ booking.customerEmail }}</span>
          </div>
          <div *ngIf="booking.notes" class="detail-row notes">
            <span class="icon">ğŸ“</span>
            <span>{{ booking.notes }}</span>
          </div>
        </div>

        <div class="booking-actions">
          <button *ngIf="booking.status === 'pending'" class="btn-confirm" (click)="confirmBooking(booking)">
            âœ… Confirm
          </button>
          <button class="btn-reminder" (click)="sendReminder(booking)">
            ğŸ”” Send Reminder
          </button>
          <button class="btn-whatsapp" (click)="whatsappCustomer(booking.customerPhone)">
            ğŸ’¬ WhatsApp
          </button>
          <button class="btn-call" (click)="callCustomer(booking.customerPhone)">
            ğŸ“ Call
          </button>
          <button *ngIf="booking.status !== 'cancelled'" class="btn-cancel" (click)="cancelBooking(booking)">
            âŒ Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Past Bookings -->
  <div *ngIf="!loading && pastBookings.length > 0" class="section">
    <h2>ğŸ“œ Past Appointments</h2>
    <div class="bookings-list">
      <div *ngFor="let booking of pastBookings" class="booking-card past-booking">
        <div class="booking-header">
          <div class="customer-info">
            <h3>{{ booking.customerName }}</h3>
            <span class="badge" [ngClass]="getStatusClass(booking.status)">
              {{ booking.status }}
            </span>
          </div>
          <div class="booking-date">
            <span class="date">ğŸ“… {{ formatDate(booking.bookingDate) }}</span>
            <span class="time">â° {{ booking.bookingTime }}</span>
          </div>
        </div>

        <div class="booking-details">
          <div class="detail-row">
            <span class="icon">ğŸ’‡</span>
            <span>{{ booking.serviceName }}</span>
          </div>
          <div class="detail-row">
            <span class="icon">ğŸ’°</span>
            <span>R{{ booking.servicePrice }}</span>
          </div>
          <div class="detail-row">
            <span class="icon">ğŸ“±</span>
            <span>{{ booking.customerPhone }}</span>
          </div>
        </div>

        <div class="booking-actions">
          <button class="btn-whatsapp" (click)="whatsappCustomer(booking.customerPhone)">
            ğŸ’¬ WhatsApp
          </button>
          <button class="btn-delete" (click)="deleteBooking(booking)">
            ğŸ—‘ï¸ Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- No Bookings -->
  <div *ngIf="!loading && filteredBookings.length === 0" class="no-bookings">
    <div class="empty-state">
      <div class="empty-icon">ğŸ“…</div>
      <h3>No bookings found</h3>
      <p>No bookings match your current filters.</p>
    </div>
  </div>
</div>

